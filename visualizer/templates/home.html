<!DOCTYPE html>
<html>
  <head>
    <title>Home</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const pieChartRadio = document.getElementById('pastel');
        const lineChartRadio = document.getElementById('lineas');
        const barChartRadio = document.getElementById('barras');
        const boxChartRadio = document.getElementById('bigotes');
        const columnCheckboxes = document.querySelectorAll('input[name="columnas"]');
        const libreriaSelect = document.getElementById('libreria');
        
        // Función para manejar cambios en los radios de tipo de gráfico
        function handleChartTypeChange() {
          if(pieChartRadio.checked) {
            // Seleccionar todas las columnas cuando se elige gráfico de pastel
            columnCheckboxes.forEach(checkbox => {
              checkbox.checked = true;
            });
            // Forzar matplotlib para gráfico de pastel (el único compatible)
            libreriaSelect.value = 'matplotlib';
            libreriaSelect.disabled = true;
          } else {
            // Habilitar el selector de librerías para otros tipos de gráficos
            libreriaSelect.disabled = false;
          }
        }
        
        // Añadir event listeners a todos los radios de tipo de gráfico
        pieChartRadio.addEventListener('change', handleChartTypeChange);
        lineChartRadio.addEventListener('change', handleChartTypeChange);
        barChartRadio.addEventListener('change', handleChartTypeChange);
        boxChartRadio.addEventListener('change', handleChartTypeChange);
        
        // Deseleccionar automáticamente el gráfico de pastel si se deselecciona alguna columna
        columnCheckboxes.forEach(checkbox => {
          checkbox.addEventListener('change', function() {
            if(!this.checked && pieChartRadio.checked) {
              pieChartRadio.checked = false;
              document.getElementById('lineas').checked = true;
              // Disparar el evento change manualmente para actualizar el estado
              const event = new Event('change');
              lineChartRadio.dispatchEvent(event);
            }
          });
        });
        
        // Inicializar el estado al cargar la página
        handleChartTypeChange();
      });
    </script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-info bg-gradient">
      <a class="navbar-brand text-light">Graficador</a>
    </nav>

    <div class="container-fluid">
      <div class="row" style="padding-top: 40px">
        <div class="col-md-9">
          <form
            method="post"
            enctype="multipart/form-data"
            action="{% url 'read_and_format_file' %}"
          >
            {% csrf_token %}
            <div class="row">
              <div class="col-sm-4 offset-sm-1">
                <div class="d-flex flex-column">
                  <input
                    type="file"
                    accept=".json,.txt,.csv"
                    name="archivo-cargado"
                    class="form-control-file mb-2"
                  />
                  <br />
                  <button
                    type="submit"
                    class="btn btn-primary"
                    id="boton-cargar"
                    name="boton-cargar"
                  >
                    Cargar
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>

        <div class="col-md-3">
          <form action="{% url 'loaded_file_visulization' %}" method="post">
            {% csrf_token %} {% if diccionario %}
            <h5>Gráficos</h5>
            <ul class="nav nav-pills flex-column">
              <li class="nav-item">
                <input
                  type="radio"
                  id="lineas"
                  name="grafico"
                  value="lineas"
                  checked
                />
                <label for="lineas">Gráfico de Líneas</label>
              </li>
              <li class="nav-item">
                <input type="radio" id="barras" name="grafico" value="barras" />
                <label for="barras">Gráfico de Barras</label>
              </li>
              <li class="nav-item">
                <input type="radio" id="pastel" name="grafico" value="pastel" />
                <label for="pastel">Gráfico de Pastel</label>
              </li>
              <li class="nav-item">
                <input
                  type="radio"
                  id="bigotes"
                  name="grafico"
                  value="bigotes"
                />
                <label for="bigotes">Gráfico de Bigotes</label>
              </li>
            </ul>
            <br />
            
            <!-- Selector de librería de visualización -->
            <div class="form-group mb-3">
              <label for="libreria">Librería de visualización:</label>
              <select class="form-control" id="libreria" name="libreria">
                <option value="matplotlib">Matplotlib (básico)</option>
                <option value="seaborn">Seaborn (estilo moderno)</option>
                <option value="ggplot">ggplot (estilo académico)</option>
              </select>
              <small class="form-text text-muted">
                Seaborn ofrece gráficos más atractivos visualmente
              </small>
            </div>
            
            <h5>Columnas</h5>
            {% for header in diccionario.headers%}
            <ul
              class="nav-pills flex-column"
              style="list-style-type: none; padding-left: 0"
            >
              <li class="nav-item">
                <input
                  type="checkbox"
                  name="columnas"
                  id="header_{{forloop.counter}}"
                  value="{{header}}"
                  {% if forloop.first %}checked{% endif %}
                />
                <label for="header_{{forloop.counter}}">{{header}}</label>
              </li>
            </ul>
            {% endfor %}
            <h5>Filas a usar</h5>
            <input
              type="number"
              name="cant_filas_usar"
              id="cant_filas_usar"
              value="{{diccionario.cant_filas}}"
              max="{{diccionario.cant_filas}}"
              min="1"
              class="form-control"
              style="width: 100px;"
            />
            <br />
            <button type="submit" class="btn btn-primary">Graficar</button>

            {% endif %}
          </form>
        </div>
      </div>
    </div>
  </body>
</html>